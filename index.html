<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Termini počitniške hišice v Banovcih</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f4f7f9; color: #333; position: relative; min-height: 100vh; padding-bottom: 60px; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 5px; }
        #calendar { max-width: 350px; margin: 0 auto 20px auto; display: grid; grid-template-columns: repeat(7, 40px); gap: 6px; background-color: white; border-radius: 10px; padding: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .day { width: 40px; height: 40px; line-height: 40px; text-align: center; cursor: pointer; border-radius: 8px; user-select: none; font-weight: 600; transition: background-color 0.25s ease, color 0.25s ease, box-shadow 0.3s ease; }
        .day.free { background-color: #a8d5a2; color: #2e7d32; }
        .day.free:hover { background-color: #81c784; }
        .day.occupied { background-color: #e57373; color: white; }
        .day.occupied:hover { background-color: #ef5350; }
        .day.other-month { color: #bbb; cursor: default; background-color: transparent; box-shadow: none !important; }
        .day.today { box-shadow: 0 0 0 3px #2980b9 inset; font-weight: 700; }
        #modeToggle { position: fixed; bottom: 15px; right: 15px; padding: 8px 14px; font-size: 14px; border: none; border-radius: 20px; background-color: rgba(52, 152, 219, 0.7); color: white; cursor: pointer; box-shadow: 0 3px 10px rgba(52,152,219,0.5); transition: background-color 0.3s ease, opacity 0.3s ease; opacity: 0.7; z-index: 1000; }
        #modeToggle:hover { background-color: rgba(41, 128, 185, 0.9); opacity: 1; }
        #instructions { text-align: center; font-style: italic; font-size: 15px; margin: 10px 0 25px 0; color: #555; }
        #monthYearNav { text-align: center; margin-bottom: 15px; font-weight: 700; font-size: 18px; color: #34495e; }
        #monthYearNav button { padding: 6px 14px; font-size: 18px; margin: 0 15px; cursor: pointer; border: none; border-radius: 6px; background-color: #ecf0f1; box-shadow: 0 2px 6px rgba(0,0,0,0.1); color: #34495e; transition: background-color 0.3s ease; }
        #monthYearNav button:hover { background-color: #bdc3c7; }
        #contacts { max-width: 350px; margin: 30px auto 0 auto; text-align: center; font-size: 15px; color: #222; background: #fff; padding: 20px 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); line-height: 1.6; }
        #contacts strong { color: #2c3e50; }
        #contacts a { color: #2980b9; text-decoration: none; }
        #contacts a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <h1>Termini počitniške hišice v Banovcih</h1>
    <div id="monthYearNav">
        <button id="prevMonth" aria-label="Prejšnji mesec">&lt;</button>
        <span id="monthYearDisplay" aria-live="polite"></span>
        <button id="nextMonth" aria-label="Naslednji mesec">&gt;</button>
    </div>
    <div id="instructions">Način ogledovalca: vidite zasedene termine, ne morete jih spreminjati.</div>
    <div id="calendar" role="grid" aria-label="Koledar"></div>
    <div id="contacts" aria-label="Kontaktne informacije za rezervacije">
        <p>Za dodatne informacije nas lahko kontaktirate na:</p>
        <p><strong>Telefon:</strong> <a href="tel:+38651315224">+386 51 315 224</a></p>
        <p><strong>E-pošta:</strong> <a href="mailto:hisicabanovci@gmail.com">hisicabanovci@gmail.com</a></p>
    </div>
    <button id="modeToggle" aria-label="Preklop med načinom urejanja in ogledovalca">Preklopi na način urejanja</button>
    <script>
        let mode = 'view';
        const password = 'sonja123+';
        const today = new Date();
        let currentYear = today.getFullYear();
        let currentMonth = today.getMonth();
        const todayDate = today.getDate();
        const calendarEl = document.getElementById('calendar');
        const modeToggleBtn = document.getElementById('modeToggle');
        const instructionsEl = document.getElementById('instructions');
        const monthYearDisplay = document.getElementById('monthYearDisplay');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');

        async function fetchOccupiedDates() {
            const response = await fetch('/.netlify/functions/occupied-dates');
            if (!response.ok) return {};
            const datesArray = await response.json();
            const datesObj = {};
            datesArray.forEach(dateStr => { datesObj[dateStr] = true; });
            return datesObj;
        }
        async function updateOccupiedDate(dateStr, occupy) {
            let method = occupy ? 'POST' : 'DELETE';
            const response = await fetch('/.netlify/functions/occupied-dates', {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ date: dateStr })
            });
            return response.ok;
        }
        const monthNames = ['Januar', 'Februar', 'Marec', 'April', 'Maj', 'Junij', 'Julij', 'Avgust', 'September', 'Oktober', 'November', 'December'];
        async function renderCalendar(year, month) {
            calendarEl.innerHTML = '';
            monthYearDisplay.textContent = monthNames[month] + ' ' + year;
            const daysOfWeek = ['Pon', 'Tor', 'Sre', 'Čet', 'Pet', 'Sob', 'Ned'];
            daysOfWeek.forEach(day => {
                const dayEl = document.createElement('div');
                dayEl.textContent = day;
                dayEl.style.fontWeight = 'bold';
                dayEl.style.userSelect = 'none';
                calendarEl.appendChild(dayEl);
            });
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            let startDay = firstDay.getDay();
            startDay = (startDay === 0) ? 6 : startDay - 1;
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = startDay - 1; i >= 0; i--) {
                const dayEl = document.createElement('div');
                dayEl.className = 'day other-month';
                dayEl.textContent = (prevMonthLastDay - i);
                calendarEl.appendChild(dayEl);
            }
            const occupiedDates = await fetchOccupiedDates();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dayEl = document.createElement('div');
                dayEl.classList.add('day');
                const dateStr = year + '-' + String(month+1).padStart(2,'0') + '-' + String(day).padStart(2,'0');
                if (occupiedDates[dateStr]) { dayEl.classList.add('occupied'); } else { dayEl.classList.add('free'); }
                dayEl.textContent = day;
                if (year === today.getFullYear() && month === today.getMonth() && day === todayDate) {
                    dayEl.classList.add('today');
                }
                dayEl.addEventListener('click', async () => {
                    if (mode !== 'edit') return;
                    const occupy = !occupiedDates[dateStr];
                    await updateOccupiedDate(dateStr, occupy);
                    await renderCalendar(currentYear, currentMonth);
                });
                calendarEl.appendChild(dayEl);
            }
            const trailingCount = 42 - (startDay + lastDay.getDate());
            for (let i = 1; i <= trailingCount; i++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'day other-month';
                dayEl.textContent = i;
                calendarEl.appendChild(dayEl);
            }
        }
        prevMonthBtn.addEventListener('click', async () => {
            if (currentMonth === 0) { currentMonth = 11; currentYear--; } else { currentMonth--; }
            await renderCalendar(currentYear, currentMonth);
        });
        nextMonthBtn.addEventListener('click', async () => {
            if (currentMonth === 11) { currentMonth = 0; currentYear++; } else { currentMonth++; }
            await renderCalendar(currentYear, currentMonth);
        });
        modeToggleBtn.addEventListener('click', async () => {
            if (mode === 'edit') {
                mode = 'view';
                modeToggleBtn.textContent = 'Preklopi na način urejanja';
                instructionsEl.textContent = 'Način ogledovalca: vidite zasedene termine, ne morete jih spreminjati.';
            } else {
                const userPass = prompt('Vnesite geslo za preklop v način urejanja:');
                if (userPass === password) {
                    mode = 'edit';
                    modeToggleBtn.textContent = 'Preklopi na način ogledovalca';
                    instructionsEl.textContent = 'Kliknite na datum, da označite termin kot prost ali zaseden.';
                } else { alert('Napačno geslo!'); return; }
            }
            await renderCalendar(currentYear, currentMonth);
        });
        renderCalendar(currentYear, currentMonth);
    </script>
</body>
</html>
